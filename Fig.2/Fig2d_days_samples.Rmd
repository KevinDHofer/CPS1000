library(tidyverse)
library(dplyr)
library(ggpubr)

#load data
usedPairs_analysis <- read.csv("~/Dropbox/Medizin/Forschung/Aktuelle Forschungsprojekte/CLL CPS1000/raw data/usedPairs_analysis.csv", sep=";")
load("~/Dropbox/Medizin/Forschung/Aktuelle Forschungsprojekte/CLL CPS1000/raw data/survival_190516.RData")
usedSamples_all <- read.csv("~/Dropbox/Medizin/Forschung/Aktuelle Forschungsprojekte/CLL CPS1000/raw data/usedSamples_all.csv", sep=";")

#110 pat
length(unique(usedPairs_analysis$patientID))

usedPairs_analysis$sample1 <- gsub("-[1234]$", "", usedPairs_analysis$sample1)
usedPairs_analysis$sample2 <- gsub("-[1234]$", "", usedPairs_analysis$sample2)

#merge tables
sample_date <- survT[,1:3]
merged_table <- merge(usedPairs_analysis, sample_date, by.x="sample1", by.y="sampleID", all.x=TRUE) |> 
  merge(usedSamples_all[,c("patientID", "diagnosis")], by="patientID")

length(unique(merged_table$patientID))

#add date for sampling2
merged_table2 <- merged_table |> 
  dplyr::rename(sampleDate1 = sampleDate)

merged_table3 <- merge(sample_date, merged_table2, by.x="sampleID", by.y="sample2", )

merged_table3 <- merged_table3 |> 
  dplyr::rename(sample2 = sampleID, sampleDate2 = sampleDate) |> 
    dplyr::select(c(patientID, sample1, sample2, sampleDate1, sampleDate2, diagnosis))

#calculate difference
merged_table4 <- merged_table3 |> 
  mutate(diff = sampleDate2-sampleDate1)

#plot
merged_table4$diff <- as.numeric(merged_table4$diff)
summary(merged_table4$diff)

Fig2d <- merged_table4 |> 
  dplyr::select(diff) |> 
  ggplot(aes(x="", y=diff)) +
    geom_boxplot(color="black", linewidth=0.5, outliers = FALSE, width=0.4) +
    geom_jitter(width = 0.1, alpha = 0.75, size=1, color="#74c476")+ 
    theme_classic() +
    labs(
    x = "",
    y = "Days between samples")+
  theme(axis.text.y = element_text(color="black", size=8), axis.line = element_line(size = 0.5), axis.ticks.x = element_blank(), axis.title.y = element_text(size=8), plot.margin=margin(r=1,l=1,t=0.5,unit="cm"))+
  scale_y_continuous(expand = c(0.02,0), breaks=c(seq(0,1750,500)))
Fig2d


